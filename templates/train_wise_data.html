{% extends 'base.html' %}
{% load custom %}
{% block body %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
<script>
/* When the user clicks on the button,
toggle between hiding and showing the dropdown content */
function myFunction() {
  document.getElementById("myDropdown").classList.toggle("show");
}

function filterFunction() {
  var input, filter, ul, li, a, i;
  input = document.getElementById("myInput");
  filter = input.value.toUpperCase();
  div = document.getElementById("myDropdown");
  a = div.getElementsByTagName("a");
  for (i = 0; i < a.length; i++) {
    txtValue = a[i].textContent || a[i].innerText;
    if (txtValue.toUpperCase().indexOf(filter) > -1) {
      a[i].style.display = "";
    } else {
      a[i].style.display = "none";
    }
  }
}
</script>



<script>
$(document).ready(function() {
    $('#select-all').click(function() {
        var checked = this.checked;
        $('input[type="checkbox"]').each(function() {
        this.checked = checked;
    });
    })
});
</script>


<style>
.dropbtn {
  background-color: #04AA6D;
  color: white;
  padding: 16px;
  font-size: 16px;
  border: none;
  cursor: pointer;
}

.dropbtn:hover, .dropbtn:focus {
  background-color: #3e8e41;
}

#myInput {
  box-sizing: border-box;
  background-image: url('searchicon.png');
  background-position: 14px 12px;
  background-repeat: no-repeat;
  font-size: 16px;
  padding: 14px 20px 12px 45px;
  border: none;
  border-bottom: 1px solid #ddd;
}

#myInput:focus {outline: 3px solid #ddd;}

.dropdown {
  position: relative;
  display: inline-block;
}

.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f6f6f6;
  min-width: 230px;
  overflow: auto;
  border: 1px solid #ddd;
  z-index: 1;
}

.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}

.dropdown a:hover {background-color: #ddd;}

.show {display: block;}
</style>






<form action="/user/train_wise_data/" method="POST">{% csrf_token %}
  <center class="center">
    <section class="pb-4">
      <div class="bg-white border rounded-5">
        
    <div class="dropdown">
      <button onclick="myFunction()" type="button" class="dropbtn">Select Train Number</button>
      <div id="myDropdown" class="dropdown-content">
        <input type="text" placeholder="Search.." id="myInput" onkeyup="filterFunction()">
        <input type="checkbox" id="select-all">
        <label for="car">Select All</label>
{% for t_n in train_number %}
{% for train_number in t_n %}
        <a>
          <input type="checkbox" value="{{train_number|convertint}}"> {{train_number | convertint}}
        </a>
{% endfor %}
{% endfor %}
      </div>
    </div>



    <label for="start_date"><b>From:</b></label>
    <input type="date" name="start_date" required>
    
    <label for="end_date"><b>To:</b></label>
    <input name="end_date" type="date" required>


    <button type="submit" class="btn btn-danger">Submit</button>
  </center>
</form>

<br>
<div class="col-xl-8 col-md-12">
<div class="card">
<div class="card-header">
<h4>Railway Data</h4>
<span class="text-muted">This is Graph Show for Railway </span>
</div>

<div class="card-blockk">
<div id="sales-analytics" style="height:100%;">

<div class="chart-container">
{% if data_show %}
  <center><h4><u>Data Show Graph For Train Number {{train_number}}</u></h4></center>
{% else %}
{% endif %}

{% if post %}
{% if data_show %}
    <canvas id="myChart" height="110px" width="100%"></canvas>
{% else %}
<br>
<center><h2>Currenly No Data for this Train Number</h2></center>
{% endif %}
{% else %}
<br>
<center><h3>Kindly Enter Train Number and Filter With Date Range To see Data</h3></center>
{% endif %}
</div>




<script>
var canvasP = document.getElementById("myChart");
var ctxP = canvasP.getContext('2d');
var myPieChart = new Chart(ctxP, {
   type: 'bar',
   data: {
      labels: [{% for m in problem_type %}'{{m}}',{% endfor %}],
      datasets: [
        {   
            label:"Complaint Number",
            data: {{data_count}},
            backgroundColor: ["#64B5F6", "#FFD54F", "#2196F3", "#FFC107", "#1976D2", "#FFA000", "#0D47A1"],
            hoverBackgroundColor: ["#B2EBF2", "#FFCCBC", "#4DD0E1", "#FF8A65", "#00BCD4", "#FF5722", "#0097A7"]
       }]
   },
   options: {
    legend: {
         display: true,
         position: "top"
      },

}
});

canvasP.onclick = function(e) {
   var slice = myPieChart.getElementAtEvent(e);
   if (!slice.length) return; // return if not clicked on slice
   var label = slice[0]._model.label;
   switch (label) {
      // add case for each label/slice
      {% for p_t in problem_type %}
      case '{{p_t}}':
         window.open('/user/complain/{{p_t}}');
         break;
      {% endfor %}
   }
}
</script>




</div>
</div>
</div>
</div>





{% endblock %}


